@page "/allactivists"
@attribute [Authorize]
@*@using promoit_frontend_cs.Data*@
@using System.Text.Json
@using System.Text.Json.Serialization
@using System.Net.Http.Headers
@using Newtonsoft.Json;
@inject IHttpClientFactory ClientFactory
@inject Microsoft​.AspNetCore​.Http.IHttpContextAccessor HttpContextAccessor
@inject HttpClient Http
@inject promoit_backend_cs_api.Data.promo_itContext DbContext


<h3>Social activists</h3>

<button class="btn btn-primary" @onclick="OnInitializedAsync">Click me</button>

<table class="table table-hover table-striped">
    <thead class="table-dark">
        <tr>
            <th>Id</th>
            <th>User_id</th>
            <th>Email</th>
            <th>Address</th>
            <th>Phone</th>
            <th>Twitter</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var socialActivist in socialActivists)
        {
            <tr>
                <td>@socialActivist.Id</td>
                <td>@socialActivist.User_id</td>
                <td>@socialActivist.Email</td>
                <td>@socialActivist.Address</td>
                <td>@socialActivist.Phone</td>
                <td>@socialActivist.Twitter</td>
            </tr>
        }
    </tbody>
</table>

@functions {

    private IEnumerable<SocialActivist> socialActivists = Array.Empty<SocialActivist>();
    //private SocialActivist[] socialActivists = Array.Empty<SocialActivist>();

    protected override async Task OnInitializedAsync()
    {
        //var request = new HttpRequestMessage(HttpMethod.Get, "https://localhost:7263/api/social-activists");

        string token = HttpContextAccessor.HttpContext.Request.Cookies["auth_token"];

        //request.Headers.Authorization = new AuthenticationHeaderValue("Bearer", token);



        Http.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token);
        var response = await Http.GetAsync("http://localhost:7000/social-activists");
        //_httpClient.DefaultRequestHeaders.Authorization = new AuhenticationHeaderValue("Bearer", "Your Oauth token");
        var json = await response.Content.ReadAsStringAsync();
        socialActivists = JsonConvert.DeserializeObject<IEnumerable<SocialActivist>>(json);

    }
}
